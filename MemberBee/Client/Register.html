<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up Form</title>
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <!--<link rel="stylesheet" href="css/normalize.css">-->
    <link href='https://fonts.googleapis.com/css?family=Nunito:400,300' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <script src="../js/Jquery.js"></script>
    <script src="../shaerd/masterScript.js"></script>
    <link href="../css/w3.css" rel="stylesheet" />

    <link href="../css/regisStyle.css" rel="stylesheet" />


    <script>
        var currentTab = 0;

        $(document).ready(function () {


            var currentTab = 0; // Current tab is set to be the first tab (0)
            //אם חזרנו לרישום דרך דף הפרופיל
            if (document.getElementById("question").disabled == true) {
                document.getElementById("prevBtn").innerHTML = "cancel";
                document.getElementById("nxtBtn").innerHTML = "update";
                if ($("#prevBtn").click == true) {
                    location.href = "ProfilePage.html"; //לחזור חזרה לפרופיל
                }
                if ($("#nxtBtn").click == true) {
                    document.getElementById("question").disabled = false;
                    showTab(currentTab);
                }
            }
            showTab(currentTab); // Display the crurrent tab

            //$(".blur").blur(function () {
            //    validateForm(this);
            //});
        });
        function showTab(n) {
            // This function will display the specified tab of the form...
            let x = document.getElementsByClassName("tab");
            //x[n].className += " w3-show";
            
            //x[n].className = "tab w3-show";

            x[n].style.display = "block";
            //... and fix the Previous/Next buttons:
            if (n == 0) {
                document.getElementById("prevBtn").innerHTML = "cancel";
                if ($("#prevBtn").click == true) {
                    GoToLog();
                }
            }
            else if (n == (x.length - 1)) {
                document.getElementById("nxtBtn").innerHTML = "save";
                //onclick($("#nxtBtn")): SaveToDB();
                openCategory();
                if ($("#nxtBtn").click == true) {
                    SaveToDB();
                }

            } else {
                document.getElementById("nxtBtn").innerHTML = "next";
                document.getElementById("prevBtn").innerHTML = "previous";

            }

            //... and run a function that will display the correct step indicator:
            fixStepIndicator(n);
        }



        function nextPrev(n) {
            // This function will figure out which tab to display
            var x = document.getElementsByClassName("tab");
            // Exit the function if any field in the current tab is invalid:
            if (n == 1 && !validateForm()) return false;
            // Hide the current tab:

            //x[currentTab].className = "tab w3-hide";
            x[currentTab].style.display = "none";
            // Increase or decrease the current tab by 1:
            //currentTab = currentTab + n;
            // if you have reached the end of the form...
            if (currentTab >= (x.length - 1)) {
                // ... the form gets submitted:
                $("#nxtBtn").click(function () {
                    alert("ok");
                    SaveToDB();
                });

            }
            else {
                //x[currentTab].className = "tab w3-hide";
                currentTab = currentTab + n;
                showTab(currentTab);
            }
            // Otherwise, display the correct tab:
            //showTab(currentTab);
        }

        function validateForm() {
            // This function deals with validation of the form fields
            let x, y, i, valid = true, name, lname, phone, mail, id;
            x = document.getElementsByClassName("tab");
            y = x[currentTab];
            name = $("#name").val();
            lname = $('#Lname').val();
            phone = $('#phone').val();
            id = $('#id_User').val();
            mail = $('#mail').val();


            if (x[currentTab] == x[0]) {

                if (name == "" || name.length < 2) {
                    
                    //$("#name").css("background-color", "aliceblue");
                    notValid("#name");
                    valid = false;
                }

                if (lname == "" || lname.length < 2) {
                    notValid('#Lname');
                    valid = false;
                }
            }
            //if () { נשים פה גנדר

            //}

            if (x[currentTab] == x[1]) {

                if (phone.length != 10) {
                    notValid('#phone');
                    alert("should be 10 digits");
                    valid = false;
                }

                if (id.length != 9) {
                    notValid('#id_User');
                    alert("should be 9 digits!");
                    valid = false;
                }


                if (mail != "") {

                    var atpos = mail.indexOf("@");
                    var dotpos = mail.lastIndexOf(".");
                    if (atpos < 1 || dotpos < atpos + 2 || dotpos + 2 >= mail.length) {
                        notValid('#mail');
                        alert("Not a valid e-mail address");
                        valid = false;
                    }
                }
                else {
                    notValid('#mail');
                    alert("Please enter e-mail");
                    valid = false;
                }
                //if ($("#citym").select() != true) {
                //    alert("chose city!");
                //    valid = false;
                //}

            }


            // If the valid status is true, mark the step as finished and valid:
            if (valid) {
                document.getElementsByClassName("step")[currentTab].className += " finish";
            }
            return valid; // return the valid status
        }

        function fixStepIndicator(n) {
            // This function removes the "active" class of all steps...
            var i, x = document.getElementsByClassName("step");
            for (i = 0; i < x.length; i++) {
                x[i].className = x[i].className.replace(" active", "");
            }
            //... and adds the "active" class on the current step:
            x[n].className += " active";
        }



        function notValid(val) {
            $(val).css("background-color", "#ffdddd");
        }


        // ביטול או סיום מוצלח של הרישום

        function GoToLog() {
            location.replace("LoginPage.html");
        }
        function SaveToDB() {

            //location.reload();

            if ($("#male").select == true) {
                var x = "male";
            }
            if ($("#female").select == true) {
                x = "female";
            }

            var NewClient = {
                FirstName: $('#name').val(),
                LastName: $("#Lname").val(),
                IdNumber: $("#id_User").val(),
                MainMail: $("#mail").val(),
                PhoneNo: $("#phone").val(),
                DateOfBirth: $("#day").val() + " " + $("#month").val() + " " + $("#year").val(),
                address: $("#address").val(),
                CityCityNumber: $("#citym").val(),
                gender: x,
                NoOfKids: $("#childNo")

            };

            localStorage.setItem(systemHelper.storege.NewClient, JSON.stringify(NewClient));
            var ClientCategory = JSON.parse(localStorage.getItem(systemHelper.storege.categorySelected));

            $.ajax({
                datatype: "json",
                url: "/api/Registration/",
                contentType: "application/json; charset=utf-8",
                method: "POST",
                data: JSON.stringify(NewClient, ClientCategory),
                success: function (data) {

                    alert(" ברוך הבא " + $('#name').val());
                    localStorage.setItem(systemHelper.storege.user, JSON.stringify(NewClient));
                    document.getElementById("question").disabled = true;
                    //$("#question").addClass("disabled");
                    location.href = "index.html";

                },
                error: function (err) {
                    console.log(err);

                    alert("Please refill again");

                }
            });

            AjaxJsonHandler(systemHelper.webApiEndPoints., systemHelper.HttpVerbs.POST, systemHelper.storege.NewChild[x], childrenyes(), GenericError);
            
        }


        // step 1

        //step 2


        //<על מנת למחוק ערכים בעדכון פרטים
        // onclick="document.getElementById('myInput').value = ''"-->



        //להקפיץ תאריך נישואים
        function marriagedate(val) {
            if (val == 2) {
                var marrigepop = document.getElementById('pop_marriage');
                marrigepop.style.display = "block";
                var span = document.getElementsByClassName("close")[0];
                // When the user clicks on <span> (x), close the modal
                span.onclick = (function () {
                    marrigepop.style.display = "none";
                    document.getElementById("status").value = 0;
                });

            }
        }

        //משהו לא מסתדר בפונקציה הזאת כוסעמק

        function childDetails(val) {
            var day = "", month = "", year = "";
            
        
            alert(val);
            if (val == 0) {
                alert("never to late to make some");
            }
            else {
                for (var i = 1; i <= val; i++) { //לבדוק הגבלה אחרת

                    var childName = `<label for="childName">שם</label><input type="text" id="${i}" name="childName" data-mini="true">`;
                    var childDate = `
                                      <label for= "controlgroup" >: תאריך לידה</label>
                            <div data-role="controlgroup" data-type="horizontal" data-mini="true" id="dateofchild">
                                        <div class="float">
                                  <select id = "Childday"></select></div>
                                  <div class="float"><select id="Childmonth"></select></div>
                                 <div class="float"><select id="Childyear"></select></div></div>`;
                    for (var d = 1; d < 32; d++) {
                        day += '<option>' + d + '</option>';

                    }
                    for (var m = 1; m < 13; m++) {
                        month += '<option>' + m + '</option>';
                    }
                    for (var y = 1990; y < 2019; y++) {
                        year += '<option>' + y + '</option>';
                    }

                    alert(childName[i]);
                    $("#childDet").append(childName);
                    $("#Childday").append(day);
                    $("#Childmonth").append(month);
                    $("#Childyear").append(year);
                    $("#childDet").append(childDate);


                }


            }

            for (var x = 1; x <= val; x++) {
                var NewChild = {
                    firstName: $("i").val(),
                    DateOfBirth: $('#dateBirth').val(),
                    CustomerIdNumber: $("#id_User").val()
                };
                alert(NewChild);
                //localStorage.setItem(systemHelper.storege.NewChild, JSON.stringify(NewChild[x]));
                //AjaxJsonHandler(systemHelper.webApiEndPoints.Child, systemHelper.HttpVerbs.POST, systemHelper.storege.NewChild[x], childrenyes(), GenericError);
            }



        }

        function childrenyes() {

            alert($(x).val());
        }

        //function ClientMarrigeDate() { להעתיק לטופס את התאריך הנבחר פלוס יצירת כפתור ערוך שינויים
        //	document.getElementById().innerHTML="תאריך נישואים:"+



        //step 3

        // פתיחת הקטגוריות באג'קס- לשנות בסקל על מנת שיעבוד
        function openCategory() {
            AjaxJsonHandler(systemHelper.webApiEndPoints.SubCategory, systemHelper.HttpVerbs.GET, null, showCategory, GenericError);
            //document.getElementById("myForm").style.display = "normal";
        }


        function showCategory(category) {
            for (let i in category) {

                $("#categoryChice").append(BringCategory(category[i]));


            }

            //for (let x in category) {
                
                
            //}

        }
        function heartRate(category, input) {
            
            let slider = document.getElementById(category);
            
            let heart;
            
            heart = document.getElementsByClassName("h6");
            for (var i = 0; i < heart.length; i++) {
                if (heart[i].id == category) {
                    heart[i].innerHTML = input;
                }
                let categorySelected = {
                    howMuchLike: $(heart[i].innerHTML),
                    SubNo: $(slider[i])
                };
                localStorage.setItem(systemHelper.storege.categorySelected, JSON.stringify(categorySelected));
            }
            


           
            

            //if (slider == heart[0]) {
            //    $(heart).append(input);
            //    alert(heart);
            //}
            
            //let heart = val;
            //if (slider == heart) {
            //    $(heart).append(".heart");
            //    $(heart).append(input);
            //}
            

        }
        function BringCategory(category) {   /* data-name="${category.CategoryChoiceNo}" id="categoryChice"*/ /**/
            var inCategory = `
                                    <div class="list">  
                                       
                                   <div class="heart"><h6 class="h6" id="${category.SubNo}"></h6></div>
                                            <div>${category.SubCategoryName}<p>
                                          <input type="range" class="slider" id="${category.SubNo}" name="${category.SubCategoryName}" onchange="heartRate(this.id, this.value)" data-mini="true" value="50" min="0" max="100" data-show-value="true">
                                              </p></div></div>
                                                `;
            

            return inCategory;
        }
        

    </script>
</head>
<body dir="rtl">

    <form action="index.html" method="post" data-mini="true" id="form" name="form" dir="rtl">
        <h1 id="header"><img id="logo" src="../images/icons/LOGO (2).png" />רישום</h1>

        <!--<img id="logo" src="../images/icons/LOGO (2).png" />-->
        <fieldset id="question">
            <div class="tab">
                <!--style="background-color:#ff7200; color:white"-->
                <h1><span class="number">1</span>Step </h1>
                <label for="user_name">שם:</label>
                <input class="inp" type="text" id="name" name="user_name" placeholder="שם" required /> <!--onblur="OnBLUR(this.value)"-->

                <input class="inp" type="text" id="Lname" name="user_name" placeholder="שם משפחה" required /> <!--onblur="OnBLUR(this.value)"-->



                <label for="controlgroup">תאריך לידה</label>
                <div data-role="controlgroup" data-type="horizontal" data-mini="true">
                    <select id="day">
                        <option>1</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                        <option>5</option>
                        <option>6</option>
                        <option>7</option>
                        <option>8</option>
                        <option>9</option>
                        <option>10</option>
                        <option>11</option>
                        <option>12</option>
                        <option>13</option>
                        <option>14</option>
                        <option>15</option>
                        <option>16</option>
                        <option>17</option>
                        <option>18</option>
                        <option>19</option>
                        <option>20</option>
                        <option>21</option>
                        <option>22</option>
                        <option>23</option>
                        <option>24</option>
                        <option>25</option>
                        <option>26</option>
                        <option>27</option>
                        <option>28</option>
                        <option>29</option>
                        <option>30</option>
                        <option>31</option>
                    </select>
                    <select id="month">
                        <option>ינואר</option>
                        <option>פברואר</option>
                        <option>מרץ</option>
                        <option>אפריל</option>
                        <option>מאי</option>
                        <option>יוני</option>
                        <option>יולי</option>
                        <option>אוגוסט</option>
                        <option>ספטמבר</option>
                        <option>אוקטובר</option>
                        <option>נובמבר</option>
                        <option>דצמבר</option>
                    </select>
                    <select id="year">
                        <option>1990</option>
                        <option>1991</option>
                        <option>1991</option>
                        <option>1991</option>
                        <option>1991</option>
                        <option>1991</option>
                        <option>1991</option>
                        <option>1991</option>
                        <option>1991</option>

                    </select>

                </div>

                <label for="male">גבר</label>
                <input class="w3-radio" id="male" type="radio" name="gender" value="male" />
                <label for="female">אישה</label>
                <input class="w3-radio" id="female" type="radio" name="gender" value="female">



            </div>
            <div class="tab">
                <h1><span class="number">2</span>Step </h1>

                <label for="id_User">ת.ז:</label>
                <input class="inp" type="text" id="id_User" name="id_User" required>

                <label for="mail">מייל:</label>
                <input class="inp" type="email" id="mail" name="user_email" required>

                <label for="phone">טלפון:</label>
                <input class="inp" type="tel" id="phone" name="phone" required>

                <label for="citym">כתובת:</label>
                <div class="city w3-row">
                    <div class="city1 w3-col">
                        <select id="citym" required>
                            <option>בחר עיר</option>
                            <option value="2">נתניה</option>
                            <option value="3">תל אביב</option>
                            <option value="4">חיפה</option>
                            <option value="7">ראשל"צ</option>
                            <option value="8">חדרה</option>
                            <option value="9">כפר יונה</option>
                            <option value="10">רמת גן</option>

                        </select>
                    </div>
                    <div class="street w3-rest"><input type="text" placeholder="רחוב" class="inp" id="address" /></div>



                </div>

            </div>

            <div class="tab">
                <h1><span class="number">3</span>Step </h1>

                <label for="status">סטטוס משפחתי:</label>
                <select id="status" onclick="marriagedate(this.value)">
                    <option value="0" selected disabled>באיזה סטטוס אני</option>
                    <option value="1">רווק</option>
                    <option value="2">נשוי</option>
                    <option value="3">גרוש</option>
                    <option value="4">אלמן</option>
                </select>
                <div id="pop_marriage" class="w3-tiny" data-role="controlgroup" data-type="horizontal">
                    <span class="close">&times;</span>
                    <br />
                    <label for="marriage_date">תאריך נישואים:</label>
                    <select class="pop_marriage" id="day">
                        <option>1</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                        <option>5</option>
                        <option>6</option>
                        <option>7</option>
                        <option>8</option>
                        <option>9</option>
                        <option>10</option>
                        <option>11</option>
                        <option>12</option>
                        <option>13</option>
                        <option>14</option>
                        <option>15</option>
                        <option>16</option>
                        <option>17</option>
                        <option>18</option>
                        <option>19</option>
                        <option>20</option>
                        <option>21</option>
                        <option>22</option>
                        <option>23</option>
                        <option>24</option>
                        <option>25</option>
                        <option>26</option>
                        <option>27</option>
                        <option>28</option>
                        <option>29</option>
                        <option>30</option>
                        <option>31</option>
                    </select>
                    <select class="pop_marriage" id="month">
                        <option>ינואר</option>
                        <option>פברואר</option>
                        <option>מרץ</option>
                        <option>אפריל</option>
                        <option>מאי</option>
                        <option>יוני</option>
                        <option>יולי</option>
                        <option>אוגוסט</option>
                        <option>ספטמבר</option>
                        <option>אוקטובר</option>
                        <option>נובמבר</option>
                        <option>דצמבר</option>
                    </select>
                    <select class="pop_marriage" id="year">
                        <option>1990</option>
                        <option>1991</option>
                        <option>1992</option>
                        <option>1993</option>
                        <option>1994</option>
                        <option>1995</option>
                        <option>1996</option>
                        <option>1997</option>
                        <option>1998</option>
                        <option>1999</option>
                        <option>2000</option>
                        <option>2001</option>
                        <option>2002</option>
                        <option>2003</option>
                        <option>2004</option>
                        <option>2005</option>
                        <option>2006</option>
                        <option>1998</option>
                        <option>1998</option>
                        <option>1998</option>

                    </select>
                    <div id="marriedbtn" class="w3-btn" onclick="ClientMarrigeDate()">שמור והמשך</div>
                </div>
                <div class="w3-tiny">
                    <label for="ChildNo">מס' ילדים:</label>
                    <select onchange="childDetails(this.value)" id="childNo" on>
                        <option selected disabled>ילדים?</option>
                        <option value="0">איו לי ילדים</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                    </select>
                </div>
                <div id="childDet"></div>


            </div>

            <div class="tab">
                <h1><span class="number">4</span>Step </h1>

                <div>
                    <label class="fa fa-arrow-down">תחומי עניין</label>
                    <div id="categoryChice"></div>




                </div>
            </div>
            <!--show which step we are-->

            <div style="text-align:center;margin-top:40px;">
                <span class="step"></span>
                <span class="step"></span>
                <span class="step"></span>
                <span class="step"></span>

            </div>

            <!-- הכפתורים- נשארים קבועים לאורך כל הדרך -->
            <div class="ui-grid-b" id="choice">
                <div class="ui-block-a" id="choice_1"><button type="button" id="nxtBtn" class="ui-btn ui-corner-all" data-mini="true" onclick="nextPrev(1)">next</button></div>
                <div class="ui-block-b" id="choice_2"><button type="button" id="prevBtn" class="ui-btn ui-corner-all" data-mini="true" onclick="nextPrev(-1)">cancel</button></div>

            </div>






        </fieldset>
    </form>





</body>
</html>
